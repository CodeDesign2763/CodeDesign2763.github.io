<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="Cache-Control" content="no-cache">
  </head>
  <script>

	<!-- Глобальные переменные -->
	
	<!-- Ссылки на документы соответствующих фреймов -->
	<!-- (синтаксический сахар) -- >
	var Goods_doc;
	var CartControl_doc;
	var Cart_doc
	
	<!-- Список доступных товаров -->
	var AvailableItemsArr=[];
	
	<!-- Выбранный товар -->
	var SelectedItem={
		Ind:-1,
		Label:null,
		Name:"Ничего не выбрано",
		Show:function()
			{
			this.Label.innerText=this.Name;
			}
		}
		
	<!-- Количество товара -->
	var ItemAmount={
		TextField:null,
		Amount:"",
		Show:function()
			{
			this.TextField.value=this.Amount;
			}
		
		}
	
	<!-- Функции для работы с кнопками -->
	var Btn={
		Lock:function(Name)
			{
			CartControl_doc.getElementsByName(Name)[0].disabled=true;
			},
		Unlock:function(Name)
			{
			CartControl_doc.getElementsByName(Name)[0].disabled=false;
			},
		SetCaption:function(Name,Caption)
			{
			CartControl_doc.getElementsByName(Name)[0].value=Caption;
			},
		SetOnclickFn:function(Name,Fn)
			{
			CartControl_doc.getElementsByName(Name)[0].addEventListener("click", Fn);
			//CartControl_doc.getElementsByName(Name)[0].onclick=Fn;
			}
		}
	
	function testxx(){alert("XXXX");};	
	<!-- Журнал (лог) -->
	var ActionLog={
		TextField:null,
		Message:function (msg)
			{
			this.TextField.value=msg+"\n"+this.TextField.value;
			}
		}
	<!-- Товары, положенные в корзину -->
	var CartArr=[];
		
	<!-- Итоговая стоимость -->
	var TotalCost=0;
	
	<!-- Функция для очистки корзины -->
	function Clear_Cart()
	{
		var i;	
		var table=Cart_doc.getElementById("CartTable");
		<!-- Удалить все строки, кроме 2-х первых и последней -->
		for (i=0;i<=table.rows.length-1;i++) 
			if ((i>=2) && (i<table.rows.length-1)) table.deleteRow(i);
		table.rows[table.rows.length-1].cells[1].innerText=0;
		TotalCost=0;
		<!-- Обнуление массива, ассоциированного с корзиной -->
		CartArr=[];
		<!-- Обнуление количества единиц выбранного товара -->
		ItemAmount.Amount=0;
		ItemAmount.Show();
		<!-- Блокировка кнопок -->
		Btn.Lock("button_add");
		Btn.Lock("button_clear");
		Btn.Lock("button_complete");
	}
	<!-- Функция для добавления товара в корзину -->
	//function Add_Item_To_Cart()
	//{
		//var amount=CartControl_doc.forms.FormCartControl.elements.text_number.value;
		////alert("Amount="+amount);
		//var table=Cart_doc.getElementById("CartTable");
		//console.log(table);
		//if (!CartArr.hasOwnProperty(SelectedItem.Ind))
		//<!-- Этот товар НЕ присутствует в корзине -->
		//if (!isNaN(parseInt(amount))) 
		//if (parseInt(amount)>0)
		//{
			//<!-- Введено корректное количество товара -->
			//console.log("Выбранный элемент="+SelectedItem.Ind);
			//CartArr[SelectedItem.Ind]=[amount,amount*AvailableItemsArr[SelectedItem.Ind][2],table.rows.length-1];
			//console.log("Индекс элемента в таблице CartArr"+CartArr[SelectedItem.Ind][2]);
			//TotalCost=TotalCost+CartArr[SelectedItem.Ind][1];
			//var LastRow=table.rows[table.rows.length-1];
			//table.deleteRow(table.rows.length-1);
			
			//var tr=Cart_doc.createElement("TR");
			
			//var td1=Cart_doc.createElement("TD");
			//var td2=Cart_doc.createElement("TD");
			//var td3=Cart_doc.createElement("TD");
			//var td4=Cart_doc.createElement("TD");
			//var td5=Cart_doc.createElement("TD");
			//var Cart_image=Cart_doc.createElement("IMG");
			
			//Cart_image.src=AvailableItemsArr[SelectedItem.Ind][0];
			//Cart_image.width="100";
			//td1.appendChild(Cart_image);
			//td2.appendChild(Cart_doc.createTextNode(AvailableItemsArr[SelectedItem.Ind][1]));
			//td3.appendChild(Cart_doc.createTextNode(AvailableItemsArr[SelectedItem.Ind][2]));
			//td4.appendChild(Cart_doc.createTextNode(CartArr[SelectedItem.Ind][0]));
			//td5.appendChild(Cart_doc.createTextNode(CartArr[SelectedItem.Ind][1]));
			
			//tr.appendChild(td1);
			//tr.appendChild(td2);
			//tr.appendChild(td3);
			//tr.appendChild(td4);
			//tr.appendChild(td5);
			
			//console.log(tr);
			
			//table.appendChild(tr);
			//table.appendChild(LastRow);
			//table.rows[table.rows.length-1].cells[1].innerText=TotalCost;
			
			//ActionLog.Message("В корзину добавлен товар \""+AvailableItemsArr[SelectedItem.Ind][1]+"\"");
			//<!--Блокировка разблокировка кнопок -->
			//Btn.Unlock("button_clear");
			//Btn.Unlock("button_complete");
			//Btn.Unlock("button_change");
			//Btn.Lock("button_add");
			
			//ActionLog.Message("Кнопка очиски корзины разблокирована");
			//ActionLog.Message("Кнопка завершения заказа разблокирована");
		//}
		//else
		//<!-- Введено некорректное количество твоара-->
		//ActionLog.Message("Ошибка! Введено неверное количество товара!");
		//else 
		//<!-- Ошибка! Товар присутствует в корзине -->
		//ActionLog.Message("Ошибка! Товар присутствует в корзине!");
	
	//};
	function Add_Item_To_Cart()
	{
		var amount=CartControl_doc.forms.FormCartControl.elements.text_number.value;
		alert("Amount="+amount);
		var table=Cart_doc.getElementById("CartTable");
		<!-- Введено корректное количество товара? -->
		if (!isNaN(parseInt(amount))) 
		if (parseInt(amount)>0)
		{
		  <!-- Корректное -->
		  <!-- Этот товар присутствует в корзине? -->
		  if (CartArr.hasOwnProperty(SelectedItem.Ind))
		  {
			<!-- Товар присутствует в корзине -->
			<!-- Последнее значение итоговой стоимости -->
			var Last_Cost=CartArr[SelectedItem.Ind][1];
			CartArr[SelectedItem.Ind][0]=amount;
			CartArr[SelectedItem.Ind][1]=amount*AvailableItemsArr[SelectedItem.Ind][2];
			TotalCost=TotalCost+CartArr[SelectedItem.Ind][1]-Last_Cost;
			alert("ROW"+CartArr[SelectedItem.Ind][2]);
			<!-- Изменяем значения количества и стоимости -->
			table.rows[CartArr[SelectedItem.Ind][2]].cells[3].innerText=CartArr[SelectedItem.Ind][0];
			table.rows[CartArr[SelectedItem.Ind][2]].cells[4].innerText=CartArr[SelectedItem.Ind][1];
			<!-- Изменяем значение итоговой стоимости -->
			table.rows[table.rows.length-1].cells[1].innerText=TotalCost;
			ActionLog.Message("Введено новое значение количества товара \""+AvailableItemsArr[SelectedItem.Ind][1]+"\"");
			
			
		  }
		  
		  else 
		  {
			<!-- Товар НЕ присутствует в корзине -->
			alert("Выбранный элемент="+SelectedItem.Ind);
			CartArr[SelectedItem.Ind]=[amount,amount*AvailableItemsArr[SelectedItem.Ind][2],table.rows.length-1];
			alert(CartArr[SelectedItem.Ind][2]);
			TotalCost=TotalCost+CartArr[SelectedItem.Ind][1];
			var LastRow=table.rows[table.rows.length-1];
			table.deleteRow(table.rows.length-1);
			
			var tr=Cart_doc.createElement("TR");
			
			var td1=Cart_doc.createElement("TD");
			var td2=Cart_doc.createElement("TD");
			var td3=Cart_doc.createElement("TD");
			var td4=Cart_doc.createElement("TD");
			var td5=Cart_doc.createElement("TD");
			var Cart_image=Cart_doc.createElement("IMG");
			
			Cart_image.src=AvailableItemsArr[SelectedItem.Ind][0];
			Cart_image.width="100";
			td1.appendChild(Cart_image);
			td2.appendChild(Cart_doc.createTextNode(AvailableItemsArr[SelectedItem.Ind][1]));
			td3.appendChild(Cart_doc.createTextNode(AvailableItemsArr[SelectedItem.Ind][2]));
			td4.appendChild(Cart_doc.createTextNode(CartArr[SelectedItem.Ind][0]));
			td5.appendChild(Cart_doc.createTextNode(CartArr[SelectedItem.Ind][1]));
			
			tr.appendChild(td1);
			tr.appendChild(td2);
			tr.appendChild(td3);
			tr.appendChild(td4);
			tr.appendChild(td5);
			
			table.appendChild(tr);
			table.appendChild(LastRow);
			table.rows[table.rows.length-1].cells[1].innerText=TotalCost;
			
			ActionLog.Message("В корзину добавлен товар \""+AvailableItemsArr[SelectedItem.Ind][1]+"\"");
			<!-- Разблокировать кнопку очиски корзины и завершения заказа -->
			Btn.Unlock("button_clear");
			Btn.Unlock("button_complete");
			ActionLog.Message("Кнопка очиски корзины разблокирована");
			ActionLog.Message("Кнопка завершения заказа разблокирована");
			
			
			
			
		  }
		  
		}
		else
		<!-- Некорректное -->
		ActionLog.Message("Ошибка! Введено неверное количество товара!");
		
	};
	
	<!-- Функция для добавления товара в список доступных -->
	function Add_Goods(GoodsImage,GoodsName,GoodsPrice)
		{
			AvailableItemsArr.push([GoodsImage,GoodsName,GoodsPrice]);
			var table=Goods_doc.getElementById("AvailableItemsTable");
			var tr=Goods_doc.createElement("TR");
			var td1=Goods_doc.createElement("TD");
			var td2=Goods_doc.createElement("TD");
			var td3=Goods_doc.createElement("TD");
			var goods_image=Goods_doc.createElement("IMG");
			var ID=table.rows.length-2;
			goods_image.src=GoodsImage;
			goods_image.width="100";
			td1.appendChild(goods_image);
			td2.appendChild(Goods_doc.createTextNode(GoodsName));
			td3.appendChild(Goods_doc.createTextNode(GoodsPrice));
			tr.appendChild(td1);
			tr.appendChild(td2);
			tr.appendChild(td3);
			<!-- Обработчик двойного клика по ряду AvailableItemsTable -->
			tr.ondblclick=function()
			{
				<!-- Определяем индекс выделенного товара -->
				
				<!-- Замыкание -->
				SelectedItem.Ind=ID;
				
				<!-- Определяем его имя и выводим на экран -->
				<!-- Замыкание -->
				SelectedItem.Name=GoodsName;
				SelectedItem.Show();
				
				if (CartControl_doc.forms.FormCartControl.elements.button_add.disabled==true)
				{
					CartControl_doc.forms.FormCartControl.elements.button_add.disabled=false;
					CartControl_doc.forms.FormCartControl.elements.text_number.disabled=false;
					ActionLog.Message("Кнопка \"Добавить выбранный товар в корзину\" разблокирована");
					
				} 
				
				if (CartArr.hasOwnProperty(SelectedItem.Ind)) 
					{
						<!-- Товар присутствует в корзине -->
						<!-- Устанавливаем количество товара такое как в корзине -->
						ItemAmount.Amount=CartArr[SelectedItem.Ind][0];
						ItemAmount.Show();
						<!-- Блокировка/разблокирование кнопок -->
						Btn.Lock("button_add");
						Btn.Unlock("button_change");
						Btn.Unlock("button_delete");
					}
				else 
					{
						<!-- Товар не присутствует в корзине -->
						<!-- Устанавливаем количестов товара 0 -->
						ItemAmount.Amount=0;
						ItemAmount.Show();
						<!-- Блокировка/разблокирование кнопок -->
						Btn.Unlock("button_add");
						Btn.Lock("button_change");
						Btn.Lock("button_delete");
					}
				ActionLog.Message("Выбран товар \""+GoodsName+"\"");
			};
			table.appendChild(tr);
			<!-- Отражение операции в журнале -->
			ActionLog.Message("Добавлен товар \""+GoodsName+"\"");
		};
	window.onload=function()
		{
			<!-- Установка нач. содерж. фреймов -->
			
			<!-- фрейм Goods -->
			Goods_doc=window.frames.Goods.document;
			<!-- Перенос длинных строк при помощи конкатенации -->
			Goods_doc.write("<table id='AvailableItemsTable'"
				+"cellspacing='10' align='left'>"
				+"<tr style='color: ;background: ;"
				+"font-size: x-large; font-family: sans-serif'>"
				+"<td colspan='3'>"
				+"<b>Доступные товары</b>"
				+"</td>"
				+"</tr>"
				+"<tr style='background: lightgreen;'>"
				+"<td>Изображение</td>"
				+"<td>Наименование</td>"
				+"<td>Цена</td>"
				+"</tr></table>");
			<!-- фрейм CartControl -->
			
			<!-- регулярное выражение для обработки html-кода
			<!-- ^(\s+)((\<|[А-Я]).+)$ -->
			<!-- \1\+\"\2\" -->
			
			CartControl_doc=window.frames.CartControl.document;
			CartControl_doc.write("<form name='FormCartControl'>"
			+"<table cellspacing='10' align='left'>"
			+"<tr style='color: ;background: ;"
				+"font-size: x-large; font-family: sans-serif'>"
				+"<td colspan='3'>"
				+"<b>Панель управления</b>"
				+"</td>"
			+"</tr>"
			+"<tr>"
			+"<td bgcolor='yellow'>"
				+"Выбран товар"
			+"</td>"
			+"<td id='SelectedItemElement'>"
				+"Hичего не выбрано"
			+"</td>"
			+"</tr>"
			+"<tr>"
			+"<td bgcolor='yellow'>"
				+"Количество"
			+"</td>"
			+"<td>"
				+"<input type='text' maxlength='4' name='text_number'"
				+" disabled onkeypress=''>"
			+"</td>"
			+"</tr>"
			+"<tr>"
			+"<td align='center' colspan='2'>"
				+"<input type='button' name='button_add' value='Добавить"
				+" выбранный товар в корзину'"
				+"disabled onclick=''>"
			+"</td>"
			+"</tr>"
			+"<tr>"
			+"<td align='center' colspan='2'>"
				+"<input type='button' name='button_change' value='Изменить"
				+" количество выбранного товара в корзине'"
				+"disabled onclick=''>"
			+"</td>"
			+"</tr>"
			+"<tr>"
			+"<td align='center' colspan='2'>"
				+"<input type='button' name='button_delete' value='Удалить"
				+" выбранный товар из корзины'"
				+"disabled onclick=''>"
			+"</td>"
			+"</tr>"
			+"<tr>"
			+"<td align='center' colspan='2'>"
				+"<input type='button' name='button_clear' value="
				+"'Удалить все товары из корзины' onclick='' disabled>"
			+"</tr>"
			+"<tr>"
			+"<td align='center' colspan='2'>"
				+"<input type='button' name='button_complete' value="
				+"'Завершить заказ' disabled onclick=''>"
			+"</tr>"
			+"<tr>"
			+"<td bgcolor='yellow' align='center' colspan='2'>"
				+"Журнал действий"
			+"</td>"
			+"</tr>"
			+"<tr>"
			+"<td align='center' colspan='2'>"
				+"<textarea name='ActionLogField' cols='40'" 
				+"rows='5' style='width:300px; height:150px; resize:none'" 
				+"disabled value=''>"
				+"</textarea>"
				
			+"</td>"
			+"</tr>"
			+"</table>"
			+"</form>");
			<!-- Фрейм Cart -->
			Cart_doc=window.frames.Cart.document;
			Cart_doc.write("<table id='CartTable' cellspacing='10' align='left'>"
			+"<tr style='"
				+"font-size: x-large; font-family: sans-serif'>"
				+"<td colspan='3'>"
				+"<b>Содержимое корзины</b>"
				+"</td>"
			+"</tr>"
			+"<tr>"
			+"<td>Изображение</td>"
			+"<td	>Наименование</td>"
			+"<td>Цена</td>"
			+"<td>Количество</td>"
			+"<td>Стоимость</td>"
			+"</tr>"
			+"<tr>"
			+"<td colspan='4' style='color: white; background: red' align='center'>Итоговая стоимость</td>"
			+"<td>0</td>"
			+"</tr>"
			+"</table>");
			<!-- Журнал событий -->
			ActionLog.TextField=CartControl_doc.forms.FormCartControl.elements.ActionLogField;
			<!-- Добавляем товары -->
			Add_Goods("Goods/mouse.jpeg","Мышь","300");
			Add_Goods("Goods/keyboard.jpeg","Клавиатура","800");
			Add_Goods("Goods/motherboard.jpeg","Материнская плата","5000");
			Add_Goods("Goods/smartphone.jpeg","Смартфон","10000");
			Add_Goods("Goods/notebook.jpeg","Ноутбук","50000");
			<!-- Название выбранного товара -->
			SelectedItem.Label=CartControl_doc.getElementById("SelectedItemElement")
			<!-- Сообщение о начале работы -->
			ActionLog.Message("Выберете товар для покупки");
			<!-- Обработка нажатия на кнопку button_add -->
			Btn.SetOnclickFn("button_add",Add_Item_To_Cart);
			<!-- Обработка нажатия на кнопку button_clear -->
			Btn.SetOnclickFn("button_clear",Clear_Cart);
			<!-- Блокировка клавиши Enter для формы FormCartControl -->
			CartControl_doc.forms.FormCartControl.addEventListener('keydown', 
				function(ev) 
				{
					if(ev.keyCode == 13) 
						ev.preventDefault();
				}
			);
			<!-- Настройка отображения количества предметов -->
			ItemAmount.TextField=CartControl_doc.forms.FormCartControl.elements.text_number;
			
			
		};
		
		
				
  </script>
</html>
  <frameset cols="30%,40%,30%">
	  <frame name="Goods" noresize="noresize"></frame>
	  <frame name="Cart" noresize="noresize"></frame>
	  <frame name="CartControl"></frame>
  </frameset>
 
</html>
